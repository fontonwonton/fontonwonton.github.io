const C=e;function e(a,b){a=a-0x1a9;const c=d();let f=c[a];return f;}(function(h,i){const y=e,j=h();while(!![]){try{const k=parseInt(y(0x1f9))/0x1+parseInt(y(0x1b3))/0x2+parseInt(y(0x1f0))/0x3*(-parseInt(y(0x1cf))/0x4)+-parseInt(y(0x1ed))/0x5+-parseInt(y(0x1aa))/0x6*(parseInt(y(0x205))/0x7)+parseInt(y(0x1c0))/0x8+-parseInt(y(0x1db))/0x9;if(k===i)break;else j['push'](j['shift']());}catch(n){j['push'](j['shift']());}}}(d,0x49225));const b=(function(){let h=!![];return function(i,j){const k=h?function(){const z=e;if(j){const n=j[z(0x20d)](i,arguments);return j=null,n;}}:function(){};return h=![],k;};}()),a=b(this,function(){const A=e,h={'TMyIl':function(o,q){return o+q;},'VYXvk':function(o){return o();},'RuZYh':'log','FUmSW':A(0x1cd)},i=function(){const B=A;let o;try{o=Function(h['TMyIl'](B(0x212)+B(0x1f7),');'))();}catch(q){o=window;}return o;},j=h['VYXvk'](i),k=j['console']=j[A(0x1fd)]||{},n=[h['RuZYh'],A(0x1bc),'info','error','exception',h['FUmSW'],'trace'];for(let o=0x0;o<n['length'];o++){const q=b[A(0x1c5)][A(0x1d0)][A(0x1f5)](b),r=n[o],s=k[r]||q;q[A(0x1e1)]=b['bind'](b),q[A(0x1eb)]=s[A(0x1eb)][A(0x1f5)](s),k[r]=q;}});a();function d(){const a2=['objectStoreNames','table','text/html','17992KTQwkE','prototype','getRegistrations','none','load','files','register','bMTtT','IPfsu','dir','addEventListener','WbNUb','1004463oqHlUl','dbAction','audio/mp4','text/css','open','get','__proto__','serviceWorker','controller','html','application/javascript','updateLastPlayed','GWuDD','onsuccess','getTime','openCursor','toString','RoKMT','1047270CsAoug','regSW','getGm','201aNOVod','active','extractZip','contains','scriptURL','bind','SKIP_WAITING','{}.constructor(\x22return\x20this\x22)(\x20)','image/bmp','418434tRYnCP','smXgF','readonly','image/svg+xml','console','/game/','controllerchange','initDB','WGlQQ','LQVIw','blob','text/plain','469XJKRPi','onerror','VAUAe','activated','video/webm','string','/index.html','saveGm','apply','/loadersw.js','application/octet-stream','gms','image/webp','return\x20(function()\x20','image/jpeg','application/gzip','14988nVnXFY','statechange','extractMultipleZips','result','state','svg','error','application/pdf','mjs','1067208pakEZU','base64','assign','application/zip','has','application/vnd.ms-fontobject','split','loadAsync','isArray','warn','getMime','DCROU','image/x-icon','1098496Sbrcwd','QpQub','audio/aac','toISOString','gm\x20loader\x20db','constructor','font/woff2','audio/mpeg','application/json','ready','put','cleanupOld'];d=function(){return a2;};return d();}import{ag as f}from'./vendor-modules.DQRjffAf.js';const p=C(0x1c4),g=0x1,c=C(0x210),m=new Set([C(0x1e4),'htm','css','js',C(0x1b2),'json','xml','txt','md','csv',C(0x1af)]);class w{constructor(){this['db']=null;}async[C(0x200)](){return this['db']?this['db']:new Promise((h,j)=>{const D=e,k=indexedDB[D(0x1df)](p,g);k['onerror']=()=>j(k[D(0x1b0)]),k[D(0x1e8)]=()=>{const E=D;this['db']=k[E(0x1ad)],h(this['db']);},k['onupgradeneeded']=n=>{const F=D,o=n['target']['result'];o[F(0x1cc)][F(0x1f3)](c)||o['createObjectStore'](c,{'keyPath':'id'});};});}async[C(0x1dc)](h,j){const k=await this['initDB']();return new Promise((n,q)=>{const r=k['transaction']([c],h)['objectStore'](c);j(r,n,q);});}async[C(0x20c)](h,j){const G=C;return this[G(0x1dc)]('readwrite',(k,n,o)=>{const H=G,q=k['put']({'id':h,'name':h,'files':j,'uploadDate':new Date()[H(0x1c3)](),'lastPlayed':new Date()['toISOString']()});q['onsuccess']=()=>n(),q[H(0x206)]=()=>o(q['error']);});}async[C(0x1e6)](h){const I=C;return this[I(0x1dc)]('readwrite',(j,k,n)=>{const J=I,o=j[J(0x1e0)](h);o['onsuccess']=()=>{const K=J,q=o['result'];if(q){q['lastPlayed']=new Date()['toISOString']();const u=j[K(0x1ca)](q);u[K(0x1e8)]=()=>k(),u[K(0x206)]=()=>n(u[K(0x1b0)]);}else k();},o['onerror']=()=>n(o['error']);});}async[C(0x1cb)](){const L=C,h={'bMTtT':function(i){return i();}};return this[L(0x1dc)]('readwrite',(j,k,n)=>{const M=L,o=j[M(0x1ea)](),q=Date['now']()-0x10e0*0x3c*0x3e8;o['onsuccess']=u=>{const N=M,v=u['target']['result'];if(v){const x=v['value'];new Date(x['lastPlayed']||x['uploadDate'])[N(0x1e9)]()<q&&v['delete'](),v['continue']();}else h[N(0x1d6)](k);},o['onerror']=()=>n(o[M(0x1b0)]);});}async[C(0x1ef)](h){const O=C;return this['dbAction'](O(0x1fb),(j,k,n)=>{const P=O,o=j[P(0x1e0)](h);o['onsuccess']=()=>k(o[P(0x1ad)]),o[P(0x206)]=()=>n(o['error']);});}async['getAllGms'](){const Q=C;return this['dbAction'](Q(0x1fb),(h,j,k)=>{const R=Q,n=h['getAll']();n['onsuccess']=()=>j(n['result']||[]),n[R(0x206)]=()=>k(n[R(0x1b0)]);});}['isBinary'](h){const S=C,j=h['split']('.')['pop']()['toLowerCase']();return!m[S(0x1b7)](j);}async[C(0x1f2)](h){const T=C,j=await(await fetch(h))[T(0x203)](),k=await new f()[T(0x1ba)](j),q={};for(const [t,u]of Object['entries'](k[T(0x1d4)]))if(!u[T(0x1d8)]){const v=this['isBinary'](t);q[t]={'content':await u['async'](v?T(0x1b4):T(0x20a)),'mime':this[T(0x1bd)](t),'binary':v};}return q;}async[C(0x1ac)](h){const U=C,j={};for(const k of h){const n=await this[U(0x1f2)](k);Object[U(0x1b5)](j,n);}return j;}[C(0x1bd)](h){const V=C,j={'WGlQQ':V(0x1ce),'RoKMT':V(0x1de),'VjHls':V(0x1e5),'WbNUb':V(0x204),'GWuDD':'image/gif','VAUAe':V(0x1fc),'LQVIw':V(0x1bf),'QpQub':V(0x1f8),'smXgF':'font/ttf','Qmiaz':'audio/ogg','DCROU':V(0x20f)},k=h[V(0x1b9)]('.')['pop']()['toLowerCase']();return{'html':'text/html','htm':j[V(0x201)],'css':j[V(0x1ec)],'js':V(0x1e5),'mjs':j['VjHls'],'json':V(0x1c8),'xml':'application/xml','txt':j[V(0x1da)],'md':'text/markdown','csv':'text/csv','png':'image/png','jpg':'image/jpeg','jpeg':V(0x213),'gif':j[V(0x1e7)],'svg':j[V(0x207)],'ico':j[V(0x202)],'webp':V(0x211),'bmp':j[V(0x1c1)],'avif':'image/avif','woff':'font/woff','woff2':V(0x1c6),'ttf':j[V(0x1fa)],'otf':'font/otf','eot':V(0x1b8),'mp3':V(0x1c7),'wav':'audio/wav','ogg':j['Qmiaz'],'m4a':V(0x1dd),'aac':V(0x1c2),'mp4':'video/mp4','webm':V(0x209),'ogv':'video/ogg','wasm':'application/wasm','zip':V(0x1b6),'gz':V(0x1a9),'pdf':V(0x1b1),'data':V(0x20f),'unityweb':V(0x20f),'bundle':V(0x20f),'bin':j[V(0x1be)],'dat':j['DCROU'],'mem':V(0x20f),'asset':j[V(0x1be)],'resource':V(0x20f)}[k]||j['DCROU'];}async['regSW'](){const W=C,h={'LacCu':'controllerchange','xPgdh':W(0x208),'bFzFa':W(0x1e2),'VmcRv':'/loadersw.js'};if(h['bFzFa']in navigator)try{let j=(await navigator[W(0x1e2)][W(0x1d1)]())['find'](k=>k[W(0x1f1)]?.[W(0x1f4)]['includes'](W(0x20e)));if(!j){const k=await navigator['serviceWorker'][W(0x1d5)](h['VmcRv'],{'scope':'/','updateViaCache':W(0x1d2)});return await navigator[W(0x1e2)]['ready'],navigator['serviceWorker'][W(0x1e3)]||await new Promise(n=>{const X=W;navigator['serviceWorker'][X(0x1d9)](h['LacCu'],n,{'once':!0x0});}),k;}if((j['installing']||j['waiting'])&&await new Promise(n=>{const Y=W,o={'IPfsu':h['xPgdh']},q=j['installing']||j['waiting'];q['addEventListener'](Y(0x1ab),()=>{const Z=Y;q[Z(0x1ae)]===o[Z(0x1d7)]&&n();});}),!navigator[W(0x1e2)]['controller']){const n=(await navigator['serviceWorker'][W(0x1c9)])[W(0x1f1)];n&&(n['postMessage']({'type':W(0x1f6)}),await new Promise(o=>{const a0=W;navigator[a0(0x1e2)]['addEventListener'](a0(0x1ff),o,{'once':!0x0});}));}return j;}catch(o){console['error']('from\x20local\x20gm\x20loader',o);}}async[C(0x1d3)](h,j){const a1=C,k={'cnoJg':'gm-'};await this[a1(0x1ee)](),await this['initDB']();const n=Array[a1(0x1bb)](h),q=(n?h[0x0]:h)['split']('/')['pop']()['replace']('.zip','')||k['cnoJg']+Date['now']();if(await this['getGm'](q))return await this['updateLastPlayed'](q),{'url':'/game/'+q+'/index.html','cached':!0x0};j&&j(!0x0);const r=n?await this[a1(0x1ac)](h):await this[a1(0x1f2)](h);return await this[a1(0x20c)](q,r),j&&j(!0x1),{'url':a1(0x1fe)+q+a1(0x20b),'cached':!0x1};}}export{w as default};